<!DOCTYPE html>
<html>
http://www.imergis.nl/asp/47.asp
http://stackoverflow.com/questions/5387042/best-way-to-overlay-an-esri-shapefile-on-google-maps
https://developers.google.com/maps/documentation/javascript/examples/layer-kml
<head>
    <title>Final Project</title>
    <meta charset="utf-8">
    <link href=bootstrap-3.1.1-dist/css/bootstrap.css rel=stylesheet media="screen">

    <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBH5IVSW7cKqUUoCyG_jbEXvpx4hyBo0Zc"></script>
    <script src=jquery-2.1.1.js></script>
    <script src=bootstrap-3.1.1-dist/js/bootstrap.min.js></script>
    <script src=jquery.csv-0.71.js></script>
    <script type="text/javascript">
        var geoXml = null;
        var geoXmlDoc = null;
        var stops = [[52.011826, 4.541892],[52.001012, 4.525712],[52.005425, 4.539274]];
        var gemeente = [[52.011826, 4.541892],[52.001012, 4.525712],[52.005425, 4.539274],[52.011826, 4.541892]];
        var gemeenteCoords = [];
        //var provincieCoords = [];
        var markers = [];
        var googleMap;
        var infoWindow;
        var provinciePolygons = [];
        var gemeentePolygons = [];
        var busStoptriangle;
        var kmlLayerProvincies;
        var kmlLayerGemeenten;
        var currentActiveCtaLayer;

        var provincieFileName = "pronvincies.csv";
        var gemeenteFileName = "gemeenten.csv";
        // last nine columns of gemeenteFile do not hold long/lat coords
        function readData(fileName, provincieBool) {
          $(document).ready(function() {
              $.ajax({
                  type: "GET",
                  url: fileName,
                  dataType: "text",
                  success: function(data) {processData(data, provincieBool);}
               });
          });
        }

        // Process data from resultgeneral into dropdown
        function processData(allText, provincieBool) {
            var parsedInput = $.csv.toArrays(allText);
            for(i=0;i<parsedInput.length;i++) {
              var coords = [];
              var row = parsedInput[i];
              console.log(row);
              if(provincieBool) {
                for(j=0;j<row.length-1;j+=2) {
                  var temp = new google.maps.LatLng(row[j+1], row[j]);
                  coords.push(temp);
                }
              }
              else {
                for(j=0;j<row.length-2;j+=2) {
                  var temp = new google.maps.LatLng(row[j+1], row[j]);
                  coords.push(temp);
                }
              }
              createPolygons(coords, provincieBool);
            }
        }

      function createPolygons(data, provincieBool) {
        // Construct the polygon.
        var polygon = new google.maps.Polygon({
          paths: data,
          strokeColor: '#FF0000',
          strokeOpacity: 0.8,
          strokeWeight: 2,
          fillColor: '#FF0000',
          fillOpacity: 0.35
        });
        polygon.setMap(googleMap);
        google.maps.event.addListener(polygon, 'click', showArrays);
        google.maps.event.addListener(polygon, 'mouseover', function () {
          this.setOptions({
            strokeColor: '#000000',
            strokeOpacity: 0.8,
            strokeWeight: 2,
            fillColor: '#000000',
            fillOpacity: 0.35
           })
        });
        google.maps.event.addListener(polygon,"mouseout",function(){
          this.setOptions({
            strokeColor: "#FF0000",
            strokeOpacity: 0.8,
            strokeWeight: 2,
            fillColor: '#FF0000',
            fillOpacity: 0.35
          });
        });
        if(provincieBool) {
          provinciePolygons.push(polygon);
        }
        else {
          gemeentePolygons.push(polygon);
        }
      }

        //var map;
      function initialize() {
        var mapOptions = {
          center: { lat: 52.011826, lng: 4.541892},
          zoom: 8
        };
        googleMap = new google.maps.Map(document.getElementById('map-canvas'),
            mapOptions);
        //readData(provincieFileName, true);
        readData(gemeenteFileName, false);
        console.log(provinciePolygons);
        initializeMarkers();
        //google.maps.event.addListener(busStoptriangle, 'click', showArrays);

        infoWindow = new google.maps.InfoWindow();

        showMarkers();

        //showProvincies();

/*        google.maps.event.addListener(kmlLayerProvincies, 'click', function(kmlEvent){
            var text = kmlEvent.featureData.description;
            console.log(text);
        });*/
      }

      function createPolygon() {
        // Construct the polygon.
          busStoptriangle = new google.maps.Polygon({
            paths: gemeenteCoords,
            strokeColor: '#FF0000',
            strokeOpacity: 0.8,
            strokeWeight: 2,
            fillColor: '#FF0000',
            fillOpacity: 0.35
          });

          busStoptriangle.setMap(googleMap);
      }

      
      function convertGemeenteToCoords() {
        for(i=0;i<gemeente.length;i++) {
            var temp = new google.maps.LatLng(gemeente[i][0], gemeente[i][1]);
            gemeenteCoords.push(temp);
        }
      }

      /** @this {google.maps.Polygon} */
    function showArrays(event) {

      // Since this polygon has only one path, we can call getPath()
      // to return the MVCArray of LatLngs.
      var vertices = this.getPath();

      var contentString = '<b>Bermuda Triangle polygon</b><br>' +
          'Clicked location: <br>' + event.latLng.lat() + ',' + event.latLng.lng() +
          '<br>';

      // Iterate over the vertices.
      for (var i =0; i < vertices.getLength(); i++) {
        var xy = vertices.getAt(i);
        contentString += '<br>' + 'Coordinate ' + i + ':<br>' + xy.lat() + ',' +
            xy.lng();
      }

      // Replace the info window's content and position.
      infoWindow.setContent("Bla bla");
      infoWindow.setPosition(event.latLng);

      infoWindow.open(googleMap);
    }

    function showProvinciePolygons() {
      for(i=0;i<provinciePolygons.length;i++) {
            provinciePolygons[i].setMap(googleMap);
      }
    }

    function showGemeentePolygons() {
      for(i=0;i<provinciePolygons.length;i++) {
        provinciePolygons[i].setMap(googleMap);
      }
    }

      function hideProvinciePolygons() {
        for(i=0;i<provinciePolygons.length;i++) {
            provinciePolygons[i].setMap(null);
        }
      }

      function hideGemeentePolygons() {
        for(i=0;i<gemeentePolygons.length;i++) {
          gemeentePolygons[i].setMap(null);
        }
      }

      function initializeMarkers() {
        for (i = 0; i<stops.length;i++) {
            var temp = new google.maps.Marker({
                position: new google.maps.LatLng(stops[i][0],stops[i][1]),
                title: "busStop" + i,
            });
            markers.push(temp);
        }
      }

      function showMarkers() {
        for(i = 0;i<markers.length;i++) {
            var marker = markers[i];
            marker.setMap(googleMap);
        }
      }

      function hideMarkers() {
        for(i = 0;i<markers.length;i++) {
            var marker = markers[i];
            marker.setMap(null);
        }
      }

      //google.maps.event.addDomListener(window, 'load', initialize);
    </script>
</head>
<style>
#map-canvas {
    height: 800px;
    width: 1100px; 
    margin-left: auto; 
    margin-right: auto; 
}

.jumbotronPadding{
    padding: 30px 15px;
    margin-top: 80px;
}
</style>

<!--<div id='editor'></div>-->


<body onload="initialize()">
    <div class="container">
        <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
              <div class="container">
                <div class="navbar-header">
                    <a class="navbar-brand">OpenOV Visualization</a>
                    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                </div>
                    <div id="navbar" class="navbar-collapse collapse">
                    </div>
                </div>
        </nav>

        <div class="container col-centered">
            <div class="jumbotron jumbotronPadding">
                <h1>OpenOV visualization</h1>
                <h4>Authors: Friso Abcouwer (4019873) & Marijn Goedegebure (4013484)</h4>
            </div>
        </div>
        <div class="container col-centered">
            <div class="row">
                <div id="map-canvas"></div>
            </div>
        </div>
    </div>
    <div id="footer" style="height:50px">
    </div>
</body>
</html>