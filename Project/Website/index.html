<!DOCTYPE html>
<html>
http://www.imergis.nl/asp/47.asp
http://stackoverflow.com/questions/5387042/best-way-to-overlay-an-esri-shapefile-on-google-maps
https://developers.google.com/maps/documentation/javascript/examples/layer-kml
<head>
    <title>Final Project</title>
    <meta charset="utf-8">
    <link href=bootstrap-3.1.1-dist/css/bootstrap.css rel=stylesheet media="screen">

    <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBH5IVSW7cKqUUoCyG_jbEXvpx4hyBo0Zc"></script>
    <script src=jquery-2.1.1.js></script>
    <script src=bootstrap-3.1.1-dist/js/bootstrap.min.js></script>
    <script type="text/javascript">
        var geoXml = null;
        var geoXmlDoc = null;
        var stops = [[52.011826, 4.541892],[52.001012, 4.525712],[52.005425, 4.539274]];
        var gemeente = [[52.011826, 4.541892],[52.001012, 4.525712],[52.005425, 4.539274],[52.011826, 4.541892]];
        var gemeenteCoords = [];
        var markers = [];
        var googleMap;
        var infoWindow;
        var polygons = [];
        var busStoptriangle;
        var kmlLayerProvincies;
        var kmlLayerGemeenten;
        var currentActiveCtaLayer;

        var provincieFileName = "File:///C:/Users/Marijn/Documents/datavis/Project/Website/testPronvincies.txt";
        function readTextFile(file)
        {
            var rawFile = new XMLHttpRequest();
            rawFile.open("GET", file, false);
            rawFile.onreadystatechange = function ()
            {
                if(rawFile.readyState === 4)
                {
                    if(rawFile.status === 200 || rawFile.status == 0)
                    {
                        var allText = rawFile.responseText;
                        processText(allText);
                    }
                }
            }
            rawFile.send(null);
        }
        function processText(text) {
          var splitted = text.split(",");
          console.log(splitted);
        }

        //var map;
      function initialize() {
        readTextFile(provincieFileName);
        //readData(gemeenteFileName);


        var mapOptions = {
          center: { lat: 52.011826, lng: 4.541892},
          zoom: 8
        };
        googleMap = new google.maps.Map(document.getElementById('map-canvas'),
            mapOptions);

        initializeMarkers();
        convertGemeenteToCoords();
        createPolygon();
        google.maps.event.addListener(busStoptriangle, 'click', showArrays);


        infoWindow = new google.maps.InfoWindow();

        showMarkers();

        showProvincies();

        google.maps.event.addListener(kmlLayerProvincies, 'click', function(kmlEvent){
            var text = kmlEvent.featureData.description;
            console.log(text);
        });
      }

      function hideKMLLayer() {
        if(currentActiveCtaLayer == "Provincies") {
          kmlLayerProvincies.setMap(null);
        }
        else if(currentActiveCtaLayer == "Gemeenten") {
          kmlLayerGemeenten.setMap(null);
        }
        currentActiveCtaLayer = "";
      }

      function showProvincies() {
        if(kmlLayerProvincies == null) {
          kmlLayerProvincies = new google.maps.KmlLayer({
            url: 'https://www.dropbox.com/s/buzo995dfi5z0xa/pronvincies.kml?dl=1'
          });
        }
        currentActiveCtaLayer = "Provincies";
        kmlLayerProvincies.setMap(googleMap);
      }

      function showGemeenten() {
        if(kmlLayerGemeenten == null) {
          kmlLayerGemeenten = new google.maps.KmlLayer({
            url: 'https://www.dropbox.com/s/mp8gsfalguj1mtf/gemeenten.kml?dl=1'
          });
        }
        currentActiveCtaLayer = "Gemeenten";
        kmlLayerGemeenten.setMap(googleMap);
      }

      function convertGemeenteToCoords() {
        for(i=0;i<gemeente.length;i++) {
            var temp = new google.maps.LatLng(gemeente[i][0], gemeente[i][1]);
            gemeenteCoords.push(temp);
        }
      }

      /** @this {google.maps.Polygon} */
    function showArrays(event) {

      // Since this polygon has only one path, we can call getPath()
      // to return the MVCArray of LatLngs.
      var vertices = this.getPath();

      var contentString = '<b>Bermuda Triangle polygon</b><br>' +
          'Clicked location: <br>' + event.latLng.lat() + ',' + event.latLng.lng() +
          '<br>';

      // Iterate over the vertices.
      for (var i =0; i < vertices.getLength(); i++) {
        var xy = vertices.getAt(i);
        contentString += '<br>' + 'Coordinate ' + i + ':<br>' + xy.lat() + ',' +
            xy.lng();
      }

      // Replace the info window's content and position.
      infoWindow.setContent(contentString);
      infoWindow.setPosition(event.latLng);

      infoWindow.open(googleMap);
    }


      function createPolygon() {
        // Construct the polygon.
          busStoptriangle = new google.maps.Polygon({
            paths: gemeenteCoords,
            strokeColor: '#FF0000',
            strokeOpacity: 0.8,
            strokeWeight: 2,
            fillColor: '#FF0000',
            fillOpacity: 0.35
          });

          busStoptriangle.setMap(googleMap);
          polygons.push(busStoptriangle);
      }

      function hidePolygons() {
        for(i=0;i<polygons.length;i++) {
            polygons[i].setMap(null);
        }
      }

      function initializeMarkers() {
        for (i = 0; i<stops.length;i++) {
            var temp = new google.maps.Marker({
                position: new google.maps.LatLng(stops[i][0],stops[i][1]),
                title: "busStop" + i,
            });
            markers.push(temp);
        }
      }

      function showMarkers() {
        for(i = 0;i<markers.length;i++) {
            var marker = markers[i];
            marker.setMap(googleMap);
        }
      }

      function hideMarkers() {
        for(i = 0;i<markers.length;i++) {
            var marker = markers[i];
            marker.setMap(null);
        }
      }

      //google.maps.event.addDomListener(window, 'load', initialize);
    </script>
</head>
<style>
#map-canvas {
    height: 800px;
    width: 1100px; 
    margin-left: auto; 
    margin-right: auto; 
}

.jumbotronPadding{
    padding: 30px 15px;
    margin-top: 80px;
}
</style>

<!--<div id='editor'></div>-->


<body onload="initialize()">
    <div class="container">
        <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
              <div class="container">
                <div class="navbar-header">
                    <a class="navbar-brand">OpenOV Visualization</a>
                    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                </div>
                    <div id="navbar" class="navbar-collapse collapse">
                    </div>
                </div>
        </nav>

        <div class="container col-centered">
            <div class="jumbotron jumbotronPadding">
                <h1>OpenOV visualization</h1>
                <h4>Authors: Friso Abcouwer (4019873) & Marijn Goedegebure (4013484)</h4>
            </div>
        </div>
        <div class="container col-centered">
            <div class="row">
                <div id="map-canvas"></div>
            </div>
        </div>
    </div>
    <div id="footer" style="height:50px">
    </div>
</body>
</html>